<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Mini App Tổng Quan Chi Tiêu</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <style>
    :root {
      --primary-color: #4e73df;
      --secondary-color: #858796;
      --success-color: #1cc88a;
      --info-color: #36b9cc;
      --warning-color: #f6c23e;
      --danger-color: #e74a3b;
      --light-color: #f8f9fc;
      --dark-color: #5a5c69;
      --shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
      --border-radius: 0.35rem;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: #f8f9fc;
      color: #333;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .app-header {
      background: linear-gradient(135deg, var(--primary-color), #2a3f9d);
      color: white;
      padding: 0.8rem 1rem;
      text-align: center;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .top-nav {
      display: flex;
      background: white;
      box-shadow: var(--shadow);
      overflow-x: auto;
      position: sticky;
      top: 48px;
      z-index: 99;
    }

    .nav-item {
      flex: 1;
      min-width: 80px;
      text-align: center;
      padding: 0.8rem 0.5rem;
      cursor: pointer;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
      font-size: 0.85rem;
    }

    .nav-item.active {
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
    }

    .nav-item i {
      display: block;
      margin-bottom: 0.3rem;
      font-size: 1.2rem;
    }

    .content-wrapper {
      padding: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    h1 {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      text-align: center;
      font-size: 1.8rem;
    }

    .notification {
      background-color: #e9ecef;
      padding: 0.75rem;
      border-radius: var(--border-radius);
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .input-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .input-group.vertical {
      flex-direction: column;
      align-items: stretch;
    }

    .input-field {
      display: flex;
      flex-direction: column;
      margin-bottom: 1rem;
    }

    .uniform-input {
      padding: 0.75rem;
      border: 1px solid #d1d3e2;
      border-radius: var(--border-radius);
      font-size: 1rem;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #2e59d9;
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-box {
      border-radius: var(--border-radius);
      padding: 1.5rem;
      color: white;
      text-align: center;
      box-shadow: var(--shadow);
    }

    .stat-box .title {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .stat-box .amount {
      font-size: 1.75rem;
      font-weight: 700;
    }

    .income { background: linear-gradient(135deg, var(--success-color), #13855c); }
    .expense { background: linear-gradient(135deg, var(--danger-color), #ae261b); }
    .balance { background: linear-gradient(135deg, var(--primary-color), #2a3f9d); }

    .transactions-list {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .transaction-item {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid #eaecf4;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .transaction-item:last-child {
      border-bottom: none;
    }

    .transaction-content {
      flex-grow: 1;
    }

    .transaction-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .transaction-meta {
      color: var(--secondary-color);
      font-size: 0.9rem;
    }

    .transaction-amount {
      font-weight: 700;
      font-size: 1.25rem;
      min-width: 120px;
      text-align: right;
    }

    .income-amount { color: var(--success-color); }
    .expense-amount { color: var(--danger-color); }

    .actions {
      display: flex;
      gap: 0.5rem;
      margin-left: 1rem;
    }

    .action-btn {
      background: none;
      border: none;
      color: var(--secondary-color);
      font-size: 1.1rem;
      cursor: pointer;
      padding: 0.5rem;
    }

    .action-btn:hover {
      color: var(--primary-color);
    }

    .chart-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 2rem;
      position: relative;
      height: 400px;
    }

    .custom-legend, .monthly-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      margin-top: 1rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 50%;
    }

    .info-section {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .info-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
    }

    .custom-text {
      margin: 1rem 0;
      line-height: 1.8;
    }

    .contact-columns {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .qr-container {
      text-align: center;
      padding: 1.5rem;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .cta-button {
      display: inline-block;
      background: var(--primary-color);
      color: white;
      padding: 0.75rem 2rem;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 600;
      margin-bottom: 1.5rem;
      transition: transform 0.3s;
    }

    .cta-button:hover {
      transform: translateY(-3px);
    }

    .qr-frame {
      border: 15px solid white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      display: inline-block;
    }

    .qr-image {
      width: 200px;
      height: auto;
      display: block;
    }

    .qr-caption {
      margin-top: 1rem;
      color: var(--secondary-color);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      width: 90%;
      max-width: 500px;
      padding: 2rem;
      animation: modalFade 0.3s;
    }

    @keyframes modalFade {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal h2 {
      margin-bottom: 1.5rem;
      text-align: center;
    }

    form label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    form input, form select, form textarea {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border: 1px solid #d1d3e2;
      border-radius: var(--border-radius);
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .cancel-btn {
      background-color: var(--secondary-color);
    }

    .save-btn {
      background-color: var(--success-color);
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 1.5rem;
      gap: 1rem;
    }

    .pagination-btn {
      padding: 0.5rem 1rem;
    }

    .keywords-list {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-top: 1.5rem;
    }

    .keyword-item {
      padding: 1rem;
      border-bottom: 1px solid #eaecf4;
      display: flex;
      justify-content: space-between;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .input-group {
        flex-direction: column;
        align-items: stretch;
      }
      
      .input-group > * {
        width: 100%;
      }
      
      .nav-item span {
        display: none;
      }
      
      .nav-item i {
        margin-bottom: 0;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .transaction-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .transaction-amount {
        text-align: left;
        margin-top: 0.5rem;
      }
      
      .actions {
        margin-left: 0;
        margin-top: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="app-header">
    <h3>©masterhmh</h3>
  </div>
  
  <!-- Navigation -->
  <div class="top-nav">
    <div class="nav-item active" data-tab="tab1"><i class="fas fa-list"></i><span>Giao dịch</span></div>
    <div class="nav-item" data-tab="tab2"><i class="fas fa-table"></i><span>Thống kê</span></div>
    <div class="nav-item" data-tab="tab3"><i class="fas fa-chart-bar"></i><span>Biểu đồ</span></div>
    <div class="nav-item" data-tab="tab4"><i class="fas fa-info-circle"></i><span>Giới thiệu</span></div>
    <div class="nav-item" data-tab="tab5"><i class="fas fa-money-bill-wave"></i><span>Liệt kê</span></div>
    <div class="nav-item" data-tab="tab6"><i class="fas fa-search"></i><span>Tìm kiếm</span></div>
    <div class="nav-item" data-tab="tab7"><i class="fas fa-key"></i><span>Từ khóa</span></div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <!-- Tab 1: Daily Transactions -->
    <div id="tab1" class="tab-content active">
      <h1>GIAO DỊCH TRONG NGÀY</h1>
      <p class="notification">Vui lòng chọn ngày và ấn "Lọc" để xem dữ liệu.</p>
      <div id="errorMessageTab1" style="color: red; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="successMessageTab1" style="color: green; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="loadingTab1" style="display: none; text-align: center; margin: 1rem 0;">
        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary-color);"></i>
      </div>
      <div class="input-group">
        Ngày: <input type="date" id="transactionDate">
        <button id="fetchTransactionsBtn">Lọc</button>
        <button id="addTransactionBtn">Thêm</button>
      </div>
      <div class="stats-container" id="dailySummary">
        <div class="stat-box income"><div class="title">Tổng thu nhập</div><div class="amount">0đ</div></div>
        <div class="stat-box expense"><div class="title">Tổng chi tiêu</div><div class="amount">0đ</div></div>
        <div class="stat-box balance"><div class="title">Số dư</div><div class="amount">0đ</div></div>
      </div>
      <div class="transactions-list" id="transactionsContainer"></div>
      <div id="pagination" style="text-align: center; margin-top: 1rem;">
        <button id="prevPage" class="pagination-btn" disabled>Trang trước</button>
        <span id="pageInfo"></span>
        <button id="nextPage" class="pagination-btn">Trang sau</button>
      </div>
    </div>

    <!-- Tab 2: Statistics -->
    <div id="tab2" class="tab-content">
      <h1>THỐNG KÊ</h1>
      <p class="notification">Vui lòng chọn khoảng thời gian và ấn "Lọc" để xem dữ liệu.</p>
      <div id="errorMessageTab2" style="color: red; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="successMessageTab2" style="color: green; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="loadingTab2" style="display: none; text-align: center; margin: 1rem 0;">
        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary-color);"></i>
      </div>
      <div class="input-group">
        Từ: <input type="date" id="startDate">
        Đến: <input type="date" id="endDate">
        <button id="fetchDataBtn">Lọc</button>
      </div>
      <div class="stats-container" id="statsContainer">
        <div class="stat-box income"><div class="title">Tổng thu nhập</div><div class="amount">0đ</div></div>
        <div class="stat-box expense"><div class="title">Tổng chi tiêu</div><div class="amount">0đ</div></div>
        <div class="stat-box balance"><div class="title">Số dư</div><div class="amount">0đ</div></div>
      </div>
      <div class="chart-container">
        <h1>BIỂU ĐỒ CHI TIÊU</h1>
        <canvas id="myChart"></canvas>
      </div>
      <div class="custom-legend" id="customLegend"></div>
    </div>

    <!-- Tab 3: Monthly Chart -->
    <div id="tab3" class="tab-content">
      <h1>BIỂU ĐỒ THU CHI THEO THÁNG</h1>
      <p class="notification">Vui lòng chọn khoảng thời gian và ấn "Lọc" để xem dữ liệu.</p>
      <div id="errorMessageTab3" style="color: red; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="successMessageTab3" style="color: green; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="loadingTab3" style="display: none; text-align: center; margin: 1rem 0;">
        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary-color);"></i>
      </div>
      <div class="input-group">
        Từ:
        <select id="startMonth">
          <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
          <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
          <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
          <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
        </select>
        Đến:
        <select id="endMonth">
          <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
          <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
          <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
          <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
        </select>
        <button id="fetchMonthlyDataBtn">Lọc</button>
      </div>
      <div class="chart-container">
        <canvas id="monthlyChart"></canvas>
        <div class="monthly-legend" id="monthlyLegend"></div>
      </div>
    </div>
    
    <!-- Tab 4: About -->
    <div id="tab4" class="tab-content">
      <h1>GIỚI THIỆU</h1>
      <div class="info-section">
        <div class="info-card">
          <h1>Về MiniApp</h1>
          <p class="custom-text">Miniapp tài chính trên Telegram giúp bạn theo dõi thu nhập và chi tiêu dễ dàng. Dựa vào dữ liệu trong Google Sheet, nó sẽ hiển thị danh sách giao dịch trong ngày, biểu đồ chi tiêu theo phân loại chi tiết và biểu đồ thu nhập – chi tiêu hàng tháng ngay trong Telegram.</p>
        </div>
        <div class="info-card">
          <h1>Ủng Hộ</h1>
          <p class="custom-text">Nếu bạn thấy nó hữu ích, hãy ủng hộ mình một ly cà phê để có thêm động lực duy trì và phát triển nhé!</p>
          <p><i class="fas fa-university" style="color: var(--primary-color);"></i><strong>Ngân hàng:</strong> TMCP Sài Gòn – Hà Nội (SHB)</p>
          <p><i class="fas fa-user" style="color: var(--primary-color);"></i><strong>Chủ tài khoản:</strong> Hoang Manh Hung</p>
          <p><i class="fas fa-credit-card" style="color: var(--primary-color);"></i><strong>Số tài khoản:</strong> 6666.6789.9999</p>
        </div>
        <div class="qr-container">
          <a href="https://momo.vn/" target="_blank" class="cta-button">Ủng hộ ngay</a>
          <div class="qr-frame">
            <img id="qrImage" src="https://i.pinimg.com/736x/7c/13/53/7c135389e26cbc6460626deb9e2aa5c6.jpg" alt="QR Code" class="qr-image">
          </div>
          <p class="qr-caption">Quét mã QR để ủng hộ qua Momo</p>
        </div>
        <div class="info-card">
          <h1>Liên Hệ</h1>
          <div class="contact-columns">
            <p><i class="fab fa-telegram-plane" style="color: var(--primary-color);"></i><strong>Telegram:</strong> <a href="https://t.me/masterhmh" target="_blank">@masterhmh</a></p>
            <p><i class="fab fa-facebook" style="color: var(--primary-color);"></i><strong>Facebook:</strong> <a href="https://facebook.com/masterhmh" target="_blank">facebook.com/masterhmh</a></p>
            </div>
        </div>
      </div>
    </div>

    <!-- Tab 5: Monthly Expenses -->
    <div id="tab5" class="tab-content">
      <h1>CHI TIÊU TRONG THÁNG</h1>
      <p class="notification">Vui lòng chọn tháng và ấn "Lọc" để xem dữ liệu.</p>
      <div id="errorMessageTab5" style="color: red; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="successMessageTab5" style="color: green; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="loadingTab5" style="display: none; text-align: center; margin: 1rem 0;">
        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary-color);"></i>
      </div>
      <div class="input-group">
        Tháng:
        <select id="expenseMonth">
          <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
          <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
          <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
          <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
        </select>
        <button id="fetchMonthlyExpensesBtn">Lọc</button>
      </div>
      <div class="stats-container" id="monthlyExpenseSummary">
        <div class="stat-box income"><div class="title">Tổng thu nhập</div><div class="amount">0đ</div></div>
        <div class="stat-box expense"><div class="title">Tổng chi tiêu</div><div class="amount">0đ</div></div>
        <div class="stat-box balance"><div class="title">Số dư</div><div class="amount">0đ</div></div>
      </div>
      <div class="transactions-list" id="monthlyExpensesContainer"></div>
      <div id="paginationMonthly" style="text-align: center; margin-top: 1rem;">
        <button id="prevPageMonthly" class="pagination-btn" disabled>Trang trước</button>
        <span id="pageInfoMonthly"></span>
        <button id="nextPageMonthly" class="pagination-btn">Trang sau</button>
      </div>
    </div>

    <!-- Tab 6: Search Transactions -->
    <div id="tab6" class="tab-content">
      <h1>TÌM KIẾM GIAO DỊCH</h1>
      <p class="notification">Nhập ít nhất một tiêu chí (nội dung, số tiền, hoặc phân loại chi tiết) để tìm kiếm. Tháng là tùy chọn.</p>
      <div id="errorMessageTab6" style="color: red; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="successMessageTab6" style="color: green; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="loadingTab6" style="display: none; text-align: center; margin: 1rem 0;">
        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary-color);"></i>
      </div>
      <div class="input-group vertical">
        <div class="input-field">
          <label>Tháng: </label>
          <select id="searchMonth" class="uniform-input">
            <option value="">Tất cả</option>
            <option value="1">Tháng 1</option><option value="2">Tháng 2</option><option value="3">Tháng 3</option>
            <option value="4">Tháng 4</option><option value="5">Tháng 5</option><option value="6">Tháng 6</option>
            <option value="7">Tháng 7</option><option value="8">Tháng 8</option><option value="9">Tháng 9</option>
            <option value="10">Tháng 10</option><option value="11">Tháng 11</option><option value="12">Tháng 12</option>
          </select>
        </div>
        <div class="input-field">
          <label>Nội dung: </label>
          <input type="text" id="searchContent" class="uniform-input" placeholder="Nhập nội dung">
        </div>
        <div class="input-field">
          <label>Số tiền: </label>
          <input type="text" id="searchAmount" class="uniform-input" placeholder="Nhập số tiền (VD: 50.000)">
        </div>
        <div class="input-field">
          <label>Phân loại chi tiết: </label>
          <select id="searchCategory" class="uniform-input">
            <option value="">Tất cả</option>
          </select>
        </div>
        <button id="searchTransactionsBtn">Tìm kiếm</button>
      </div>
      <div class="transactions-list" id="searchResultsContainer"></div>
      <div id="paginationSearch">
        <button id="prevPageSearch" class="pagination-btn" disabled>Trang trước</button>
        <span id="pageInfoSearch"></span>
        <button id="nextPageSearch" class="pagination-btn">Trang sau</button>
      </div>
    </div>

    <!-- Tab 7: Keywords Management -->
    <div id="tab7" class="tab-content">
      <h1>QUẢN LÝ TỪ KHÓA</h1>
      <p class="notification">Chọn phân loại chi tiết và nhập từ khóa để thêm hoặc xóa khỏi sheet Từ khóa.</p>
      <div id="errorMessageTab7" style="color: red; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="successMessageTab7" style="color: green; text-align: center; display: none; margin-bottom: 1rem;"></div>
      <div id="loadingTab7" style="display: none; text-align: center; margin: 1rem 0;">
        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary-color);"></i>
      </div>
      <div class="input-group vertical">
        <div class="input-field">
          <label>Phân loại chi tiết: </label>
          <select id="keywordCategory" class="uniform-input">
            <option value="">Chọn phân loại</option>
          </select>
        </div>
        <div class="input-field">
          <label>Từ khóa: </label>
          <input type="text" id="keywordInput" class="uniform-input" placeholder="Nhập từ khóa (VD: đổ dầu, đổ xăng)">
        </div>
        <div class="button-group">
          <button id="addKeywordBtn">Thêm từ khóa</button>
          <button id="deleteKeywordBtn">Xóa từ khóa</button>
        </div>
        <button id="fetchKeywordsBtn">Tải dữ liệu</button>
      </div>
      <div class="keywords-list" id="keywordsContainer"></div>
    </div>

    <!-- Modals -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <h2>Chỉnh sửa giao dịch</h2>
        <div id="editError" class="error-message"></div>
        <form id="editForm">
          <label for="editTransactionId">Mã giao dịch:</label>
          <input type="text" id="editTransactionId" readonly>
          <label for="editDate">Ngày:</label>
          <input type="date" id="editDate" required>
          <label for="editContent">Nội dung:</label>
          <input type="text" id="editContent" placeholder="Nhập nội dung giao dịch" required>
          <label for="editAmount">Số tiền:</label>
          <input type="text" id="editAmount" placeholder="Nhập số tiền (VD: 5.000)" required>
          <label for="editType">Phân loại:</label>
          <select id="editType" required>
            <option value="Thu nhập">Thu nhập</option>
            <option value="Chi tiêu">Chi tiêu</option>
          </select>
          <label for="editCategory">Phân loại chi tiết:</label>
          <select id="editCategory" required></select>
          <label for="editNote">Ghi chú (nếu có):</label>
          <textarea id="editNote" placeholder="Nhập ghi chú (tùy chọn)"></textarea>
          <div class="btn-group">
            <button type="button" class="cancel-btn" onclick="closeEditForm()">Hủy</button>
            <button type="submit" class="save-btn">Lưu</button>
          </div>
        </form>
      </div>
    </div>

    <div id="addModal" class="modal">
      <div class="modal-content">
        <h2>Thêm giao dịch mới</h2>
        <div id="addError" class="error-message"></div>
        <form id="addForm">
          <label for="addDate">Ngày:</label>
          <input type="date" id="addDate" required>
          <label for="addContent">Nội dung:</label>
          <input type="text" id="addContent" placeholder="Nhập nội dung giao dịch" required>
          <label for="addAmount">Số tiền:</label>
          <input type="text" id="addAmount" placeholder="Nhập số tiền (VD: 5.000)" required>
          <label for="addType">Phân loại:</label>
          <select id="addType" required>
            <option value="Thu nhập">Thu nhập</option>
            <option value="Chi tiêu">Chi tiêu</option>
          </select>
          <label for="addCategory">Phân loại chi tiết:</label>
          <select id="addCategory" required></select>
          <label for="addNote">Ghi chú (nếu có):</label>
          <textarea id="addNote" placeholder="Nhập ghi chú (tùy chọn)"></textarea>
          <div class="btn-group">
            <button type="button" class="cancel-btn" onclick="closeAddForm()">Hủy</button>
            <button type="submit" class="save-btn">Lưu</button>
          </div>
        </form>
      </div>
    </div>

    <div id="confirmDeleteModal" class="modal">
      <div class="modal-content">
        <h2>Xác nhận xóa</h2>
        <p>Bạn có chắc chắn muốn xóa giao dịch này? Hành động này không thể hoàn tác.</p>
        <div class="btn-group">
          <button type="button" class="cancel-btn" onclick="closeConfirmDeleteModal()">Hủy</button>
          <button type="button" class="save-btn" id="confirmDeleteBtn">Xóa</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==========================================================================
    // 1. Khai báo biến toàn cục và dữ liệu
    // ==========================================================================
    let currentPage = 1;
    const transactionsPerPage = 10;
    let currentTab = 'tab1';
    let transactionsData = [];
    let monthlyData = [];
    let searchResults = [];
    let keywordsData = [];
    
    // Dữ liệu danh mục nội tuyến
    const categoriesData = {
      income_categories: [
        "Lương chính",
        "Lương phụ",
        "Đầu tư",
        "Kinh doanh",
        "Quà tặng",
        "Khác"
      ],
      expense_categories: [
        "Ăn uống",
        "Di chuyển",
        "Nhà ở",
        "Hóa đơn",
        "Mua sắm",
        "Giải trí",
        "Sức khỏe",
        "Giáo dục",
        "Cho vay",
        "Từ thiện",
        "Khác"
      ]
    };
    
    // Dữ liệu giao dịch mẫu nội tuyến
    const sampleTransactions = [
      {
        "id": "GD001",
        "date": "2023-10-15",
        "content": "Lương tháng 10",
        "amount": 15000000,
        "type": "Thu nhập",
        "category": "Lương chính",
        "note": ""
      },
      {
        "id": "GD002",
        "date": "2023-10-16",
        "content": "Mua đồ siêu thị",
        "amount": 750000,
        "type": "Chi tiêu",
        "category": "Ăn uống",
        "note": "Mua thực phẩm tuần"
      },
      {
        "id": "GD003",
        "date": "2023-10-17",
        "content": "Tiền điện",
        "amount": 450000,
        "type": "Chi tiêu",
        "category": "Hóa đơn",
        "note": "Tháng 10"
      },
      {
        "id": "GD004",
        "date": "2023-10-18",
        "content": "Mua quần áo",
        "amount": 1200000,
        "type": "Chi tiêu",
        "category": "Mua sắm",
        "note": "Quần tây công sở"
      },
      {
        "id": "GD005",
        "date": "2023-10-19",
        "content": "Tiền thưởng dự án",
        "amount": 5000000,
        "type": "Thu nhập",
        "category": "Lương phụ",
        "note": "Dự án XYZ"
      }
    ];
    
    // Dữ liệu từ khóa mẫu nội tuyến
    const sampleKeywords = [
      {
        "category": "Ăn uống",
        "keyword": "cafe"
      },
      {
        "category": "Ăn uống",
        "keyword": "nhà hàng"
      },
      {
        "category": "Di chuyển",
        "keyword": "xăng"
      },
      {
        "category": "Hóa đơn",
        "keyword": "tiền điện"
      },
      {
        "category": "Hóa đơn",
        "keyword": "tiền nước"
      }
    ];

    // ==========================================================================
    // 2. Hàm khởi tạo ứng dụng
    // ==========================================================================
    document.addEventListener('DOMContentLoaded', function() {
        // Khởi tạo ngày mặc định
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('transactionDate').value = today;
        document.getElementById('startDate').value = today;
        document.getElementById('endDate').value = today;
        document.getElementById('addDate').value = today;
        document.getElementById('editDate').value = today;

        // Thiết lập tháng hiện tại
        const currentMonth = new Date().getMonth() + 1;
        document.getElementById('startMonth').value = currentMonth;
        document.getElementById('endMonth').value = currentMonth;
        document.getElementById('expenseMonth').value = currentMonth;
        document.getElementById('searchMonth').value = currentMonth;

        // Đăng ký sự kiện
        setupEventListeners();
        
        // Tải dữ liệu ban đầu
        loadInitialData();
        
        // Hiển thị tab đầu tiên
        showTab(currentTab);
    });

    // ==========================================================================
    // 3. Thiết lập sự kiện
    // ==========================================================================
    function setupEventListeners() {
        // Chuyển tab
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                currentTab = this.getAttribute('data-tab');
                showTab(currentTab);
            });
        });

        // Tab 1: Giao dịch trong ngày
        document.getElementById('fetchTransactionsBtn').addEventListener('click', fetchDailyTransactions);
        document.getElementById('addTransactionBtn').addEventListener('click', openAddForm);
        document.getElementById('prevPage').addEventListener('click', () => changePage(-1));
        document.getElementById('nextPage').addEventListener('click', () => changePage(1));

        // Tab 2: Thống kê
        document.getElementById('fetchDataBtn').addEventListener('click', fetchStatistics);

        // Tab 3: Biểu đồ thu chi
        document.getElementById('fetchMonthlyDataBtn').addEventListener('click', fetchMonthlyChart);

        // Tab 5: Chi tiêu trong tháng
        document.getElementById('fetchMonthlyExpensesBtn').addEventListener('click', fetchMonthlyExpenses);
        document.getElementById('prevPageMonthly').addEventListener('click', () => changeMonthlyPage(-1));
        document.getElementById('nextPageMonthly').addEventListener('click', () => changeMonthlyPage(1));

        // Tab 6: Tìm kiếm
        document.getElementById('searchTransactionsBtn').addEventListener('click', searchTransactions);
        document.getElementById('prevPageSearch').addEventListener('click', () => changeSearchPage(-1));
        document.getElementById('nextPageSearch').addEventListener('click', () => changeSearchPage(1));

        // Tab 7: Từ khóa
        document.getElementById('addKeywordBtn').addEventListener('click', addKeyword);
        document.getElementById('deleteKeywordBtn').addEventListener('click', deleteKeyword);
        document.getElementById('fetchKeywordsBtn').addEventListener('click', fetchKeywords);

        // Modal
        document.getElementById('editForm').addEventListener('submit', saveEditedTransaction);
        document.getElementById('addForm').addEventListener('submit', saveNewTransaction);
        document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
    }

    // ==========================================================================
    // 4. Hàm xử lý tab
    // ==========================================================================
    function showTab(tabId) {
        // Ẩn tất cả tab
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Hiển thị tab được chọn
        document.getElementById(tabId).classList.add('active');
        
        // Cập nhật navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('data-tab') === tabId) {
                item.classList.add('active');
            }
        });
        
        // Reset phân trang
        currentPage = 1;
        
        // Xử lý đặc biệt cho từng tab
        if (tabId === 'tab1') {
            fetchDailyTransactions();
        } else if (tabId === 'tab2') {
            fetchStatistics();
        } else if (tabId === 'tab3') {
            fetchMonthlyChart();
        } else if (tabId === 'tab5') {
            fetchMonthlyExpenses();
        } else if (tabId === 'tab7') {
            fetchCategories();
        }
    }

    // ==========================================================================
    // 5. Hàm tải dữ liệu ban đầu
    // ==========================================================================
    function loadInitialData() {
        try {
            // Tải danh mục từ dữ liệu nội tuyến
            const categories = [...categoriesData.income_categories, ...categoriesData.expense_categories];
            
            // Điền danh mục vào các dropdown
            populateCategoryDropdowns(categories);
            
            // Tải dữ liệu giao dịch
            fetchDailyTransactions();
            
        } catch (error) {
            console.error('Lỗi khi tải dữ liệu ban đầu:', error);
            showError('tab1', 'Không thể tải dữ liệu. Vui lòng thử lại sau.');
        }
    }

    // ==========================================================================
    // 6. Hàm xử lý danh mục
    // ==========================================================================
    function populateCategoryDropdowns() {
        const categories = [...categoriesData.income_categories, ...categoriesData.expense_categories];
        const dropdowns = [
            'editCategory', 
            'addCategory', 
            'searchCategory', 
            'keywordCategory'
        ];
        
        dropdowns.forEach(dropdownId => {
            const dropdown = document.getElementById(dropdownId);
            dropdown.innerHTML = '<option value="">Chọn phân loại</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                dropdown.appendChild(option);
            });
        });
    }

    // ==========================================================================
    // 7. Tab 1: Giao dịch trong ngày
    // ==========================================================================
    function fetchDailyTransactions() {
        const date = document.getElementById('transactionDate').value;
        showLoading('tab1');
        hideMessages('tab1');

        try {
            // Sử dụng dữ liệu nội tuyến
            transactionsData = sampleTransactions.filter(t => t.date === date);
            
            // Hiển thị kết quả
            displayDailyTransactions();
            updateDailySummary();
            
            showSuccess('tab1', `Đã tải ${transactionsData.length} giao dịch`);
        } catch (error) {
            console.error('Lỗi khi tải giao dịch:', error);
            showError('tab1', 'Không thể tải dữ liệu. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab1');
        }
    }

    function displayDailyTransactions() {
        const container = document.getElementById('transactionsContainer');
        container.innerHTML = '';
        
        // Tính toán phân trang
        const startIndex = (currentPage - 1) * transactionsPerPage;
        const endIndex = startIndex + transactionsPerPage;
        const paginatedData = transactionsData.slice(startIndex, endIndex);
        
        if (paginatedData.length === 0) {
            container.innerHTML = '<div class="no-data">Không có giao dịch nào</div>';
            return;
        }
        
        // Hiển thị giao dịch
        paginatedData.forEach(transaction => {
            const transactionEl = document.createElement('div');
            transactionEl.className = 'transaction-item';
            transactionEl.innerHTML = `
                <div class="transaction-content">
                    <div class="transaction-title">${transaction.content}</div>
                    <div class="transaction-meta">
                        ${transaction.date} | ${transaction.category} ${transaction.note ? '| ' + transaction.note : ''}
                    </div>
                </div>
                <div class="transaction-amount ${transaction.type === 'Thu nhập' ? 'income-amount' : 'expense-amount'}">
                    ${transaction.type === 'Thu nhập' ? '+' : '-'}${formatCurrency(transaction.amount)}
                </div>
                <div class="actions">
                    <button class="action-btn edit-btn" data-id="${transaction.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" data-id="${transaction.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(transactionEl);
        });
        
        // Cập nhật phân trang
        updatePagination(transactionsData.length, 'pageInfo', 'prevPage', 'nextPage');
        
        // Thêm sự kiện cho nút chỉnh sửa/xóa
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', () => openEditForm(btn.dataset.id));
        });
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', () => openConfirmDelete(btn.dataset.id));
        });
    }

    function updateDailySummary() {
        const income = transactionsData
            .filter(t => t.type === 'Thu nhập')
            .reduce((sum, t) => sum + t.amount, 0);
            
        const expense = transactionsData
            .filter(t => t.type === 'Chi tiêu')
            .reduce((sum, t) => sum + t.amount, 0);
            
        const balance = income - expense;
        
        document.querySelector('#dailySummary .income .amount').textContent = formatCurrency(income);
        document.querySelector('#dailySummary .expense .amount').textContent = formatCurrency(expense);
        document.querySelector('#dailySummary .balance .amount').textContent = formatCurrency(balance);
    }

    // ==========================================================================
    // 8. Tab 2: Thống kê
    // ==========================================================================
    function fetchStatistics() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        
        if (!startDate || !endDate) {
            showError('tab2', 'Vui lòng chọn khoảng thời gian');
            return;
        }
        
        showLoading('tab2');
        hideMessages('tab2');

        try {
            // Sử dụng dữ liệu nội tuyến
            const filteredData = sampleTransactions.filter(t => {
                return t.date >= startDate && t.date <= endDate;
            });
            
            // Hiển thị kết quả
            updateStatisticsSummary(filteredData);
            renderStatisticsChart(filteredData);
            
            showSuccess('tab2', `Đã tải ${filteredData.length} giao dịch`);
        } catch (error) {
            console.error('Lỗi khi tải thống kê:', error);
            showError('tab2', 'Không thể tải dữ liệu. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab2');
        }
    }

    function updateStatisticsSummary(transactions) {
        const income = transactions
            .filter(t => t.type === 'Thu nhập')
            .reduce((sum, t) => sum + t.amount, 0);
            
        const expense = transactions
            .filter(t => t.type === 'Chi tiêu')
            .reduce((sum, t) => sum + t.amount, 0);
            
        const balance = income - expense;
        
        document.querySelector('#statsContainer .income .amount').textContent = formatCurrency(income);
        document.querySelector('#statsContainer .expense .amount').textContent = formatCurrency(expense);
        document.querySelector('#statsContainer .balance .amount').textContent = formatCurrency(balance);
    }

    function renderStatisticsChart(transactions) {
        const ctx = document.getElementById('myChart').getContext('2d');
        
        // Nhóm dữ liệu theo category
        const categoryMap = {};
        
        transactions.forEach(t => {
            if (t.type === 'Chi tiêu') {
                if (!categoryMap[t.category]) {
                    categoryMap[t.category] = 0;
                }
                categoryMap[t.category] += t.amount;
            }
        });
        
        // Chuẩn bị dữ liệu cho biểu đồ
        const labels = Object.keys(categoryMap);
        const data = Object.values(categoryMap);
        
        // Tạo màu ngẫu nhiên
        const backgroundColors = labels.map(() => {
            const r = Math.floor(Math.random() * 255);
            const g = Math.floor(Math.random() * 255);
            const b = Math.floor(Math.random() * 255);
            return `rgba(${r}, ${g}, ${b}, 0.7)`;
        });
        
        // Hủy biểu đồ cũ nếu tồn tại
        if (window.statisticsChart) {
            window.statisticsChart.destroy();
        }
        
        // Tạo biểu đồ mới
        window.statisticsChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const percentage = Math.round((value / context.dataset.data.reduce((a, b) => a + b, 0)) * 100);
                                return `${label}: ${formatCurrency(value)} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
        
        // Tạo legend tùy chỉnh
        createCustomLegend(labels, backgroundColors, data);
    }

    function createCustomLegend(labels, colors, values) {
        const total = values.reduce((a, b) => a + b, 0);
        const legendContainer = document.getElementById('customLegend');
        legendContainer.innerHTML = '';
        
        labels.forEach((label, index) => {
            const percentage = Math.round((values[index] / total) * 100);
            
            const legendItem = document.createElement('div');
            legendItem.className = 'legend-item';
            legendItem.innerHTML = `
                <div class="legend-color" style="background-color: ${colors[index]}"></div>
                <div class="legend-label">${label}</div>
                <div class="legend-value">${formatCurrency(values[index])} (${percentage}%)</div>
            `;
            legendContainer.appendChild(legendItem);
        });
    }

    // ==========================================================================
    // 9. Tab 3: Biểu đồ thu chi theo tháng
    // ==========================================================================
    function fetchMonthlyChart() {
        const startMonth = parseInt(document.getElementById('startMonth').value);
        const endMonth = parseInt(document.getElementById('endMonth').value);
        
        if (startMonth > endMonth) {
            showError('tab3', 'Tháng bắt đầu phải nhỏ hơn tháng kết thúc');
            return;
        }
        
        showLoading('tab3');
        hideMessages('tab3');

        try {
            // Sử dụng dữ liệu nội tuyến
            monthlyData = [];
            const months = [];
            
            for (let month = startMonth; month <= endMonth; month++) {
                const monthData = sampleTransactions.filter(t => {
                    const transactionMonth = parseInt(t.date.split('-')[1]);
                    return transactionMonth === month;
                });
                
                const income = monthData
                    .filter(t => t.type === 'Thu nhập')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const expense = monthData
                    .filter(t => t.type === 'Chi tiêu')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                monthlyData.push({ month, income, expense });
                months.push(`Tháng ${month}`);
            }
            
            // Hiển thị biểu đồ
            renderMonthlyChart(months);
            
            showSuccess('tab3', `Đã tải dữ liệu cho ${months.length} tháng`);
        } catch (error) {
            console.error('Lỗi khi tải biểu đồ:', error);
            showError('tab3', 'Không thể tải dữ liệu. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab3');
        }
    }

    function renderMonthlyChart(months) {
        const ctx = document.getElementById('monthlyChart').getContext('2d');
        
        // Hủy biểu đồ cũ nếu tồn tại
        if (window.monthlyChart) {
            window.monthlyChart.destroy();
        }
        
        // Tạo biểu đồ mới
        window.monthlyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Thu nhập',
                        data: monthlyData.map(d => d.income),
                        backgroundColor: 'rgba(28, 200, 138, 0.7)',
                        borderColor: 'rgba(28, 200, 138, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Chi tiêu',
                        data: monthlyData.map(d => d.expense),
                        backgroundColor: 'rgba(231, 74, 59, 0.7)',
                        borderColor: 'rgba(231, 74, 59, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return formatCurrency(value);
                            }
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.dataset.label || '';
                                const value = context.raw || 0;
                                return `${label}: ${formatCurrency(value)}`;
                            }
                        }
                    }
                }
            }
        });
        
        // Tạo legend
        createMonthlyLegend();
    }

    function createMonthlyLegend() {
        const legendContainer = document.getElementById('monthlyLegend');
        legendContainer.innerHTML = '';
        
        const incomeItem = document.createElement('div');
        incomeItem.className = 'legend-item';
        incomeItem.innerHTML = `
            <div class="legend-color" style="background-color: rgba(28, 200, 138, 0.7)"></div>
            <div class="legend-label">Thu nhập</div>
        `;
        
        const expenseItem = document.createElement('div');
        expenseItem.className = 'legend-item';
        expenseItem.innerHTML = `
            <div class="legend-color" style="background-color: rgba(231, 74, 59, 0.7)"></div>
            <div class="legend-label">Chi tiêu</div>
        `;
        
        legendContainer.appendChild(incomeItem);
        legendContainer.appendChild(expenseItem);
    }

    // ==========================================================================
    // 10. Tab 5: Chi tiêu trong tháng
    // ==========================================================================
    function fetchMonthlyExpenses() {
        const month = parseInt(document.getElementById('expenseMonth').value);
        showLoading('tab5');
        hideMessages('tab5');

        try {
            // Sử dụng dữ liệu nội tuyến
            transactionsData = sampleTransactions.filter(t => {
                const transactionMonth = parseInt(t.date.split('-')[1]);
                return transactionMonth === month;
            });
            
            // Hiển thị kết quả
            displayMonthlyExpenses();
            updateMonthlyExpenseSummary();
            
            showSuccess('tab5', `Đã tải ${transactionsData.length} giao dịch`);
        } catch (error) {
            console.error('Lỗi khi tải giao dịch:', error);
            showError('tab5', 'Không thể tải dữ liệu. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab5');
        }
    }

    function displayMonthlyExpenses() {
        const container = document.getElementById('monthlyExpensesContainer');
        container.innerHTML = '';
        
        // Tính toán phân trang
        const startIndex = (currentPage - 1) * transactionsPerPage;
        const endIndex = startIndex + transactionsPerPage;
        const paginatedData = transactionsData.slice(startIndex, endIndex);
        
        if (paginatedData.length === 0) {
            container.innerHTML = '<div class="no-data">Không có giao dịch nào</div>';
            return;
        }
        
        // Hiển thị giao dịch
        paginatedData.forEach(transaction => {
            const transactionEl = document.createElement('div');
            transactionEl.className = 'transaction-item';
            transactionEl.innerHTML = `
                <div class="transaction-content">
                    <div class="transaction-title">${transaction.content}</div>
                    <div class="transaction-meta">
                        ${transaction.date} | ${transaction.category} ${transaction.note ? '| ' + transaction.note : ''}
                    </div>
                </div>
                <div class="transaction-amount ${transaction.type === 'Thu nhập' ? 'income-amount' : 'expense-amount'}">
                    ${transaction.type === 'Thu nhập' ? '+' : '-'}${formatCurrency(transaction.amount)}
                </div>
                <div class="actions">
                    <button class="action-btn edit-btn" data-id="${transaction.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" data-id="${transaction.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(transactionEl);
        });
        
        // Cập nhật phân trang
        updatePagination(transactionsData.length, 'pageInfoMonthly', 'prevPageMonthly', 'nextPageMonthly');
        
        // Thêm sự kiện cho nút chỉnh sửa/xóa
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', () => openEditForm(btn.dataset.id));
        });
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', () => openConfirmDelete(btn.dataset.id));
        });
    }

    function updateMonthlyExpenseSummary() {
        const income = transactionsData
            .filter(t => t.type === 'Thu nhập')
            .reduce((sum, t) => sum + t.amount, 0);
            
        const expense = transactionsData
            .filter(t => t.type === 'Chi tiêu')
            .reduce((sum, t) => sum + t.amount, 0);
            
        const balance = income - expense;
        
        document.querySelector('#monthlyExpenseSummary .income .amount').textContent = formatCurrency(income);
        document.querySelector('#monthlyExpenseSummary .expense .amount').textContent = formatCurrency(expense);
        document.querySelector('#monthlyExpenseSummary .balance .amount').textContent = formatCurrency(balance);
    }

    // ==========================================================================
    // 11. Tab 6: Tìm kiếm giao dịch
    // ==========================================================================
    function searchTransactions() {
        const month = document.getElementById('searchMonth').value;
        const content = document.getElementById('searchContent').value.trim();
        const amount = document.getElementById('searchAmount').value.trim();
        const category = document.getElementById('searchCategory').value;
        
        if (!content && !amount && !category) {
            showError('tab6', 'Vui lòng nhập ít nhất một tiêu chí tìm kiếm');
            return;
        }
        
        showLoading('tab6');
        hideMessages('tab6');

        try {
            // Sử dụng dữ liệu nội tuyến
            searchResults = sampleTransactions.filter(t => {
                // Lọc theo tháng
                if (month) {
                    const transactionMonth = parseInt(t.date.split('-')[1]);
                    if (transactionMonth !== parseInt(month)) return false;
                }
                
                // Lọc theo nội dung
                if (content && !t.content.toLowerCase().includes(content.toLowerCase())) {
                    return false;
                }
                
                // Lọc theo số tiền
                if (amount) {
                    const searchAmount = parseInt(amount.replace(/\./g, ''));
                    if (t.amount !== searchAmount) return false;
                }
                
                // Lọc theo danh mục
                if (category && t.category !== category) {
                    return false;
                }
                
                return true;
            });
            
            // Hiển thị kết quả
            displaySearchResults();
            
            showSuccess('tab6', `Tìm thấy ${searchResults.length} giao dịch`);
        } catch (error) {
            console.error('Lỗi khi tìm kiếm:', error);
            showError('tab6', 'Không thể tải dữ liệu. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab6');
        }
    }

    function displaySearchResults() {
        const container = document.getElementById('searchResultsContainer');
        container.innerHTML = '';
        
        // Tính toán phân trang
        const startIndex = (currentPage - 1) * transactionsPerPage;
        const endIndex = startIndex + transactionsPerPage;
        const paginatedData = searchResults.slice(startIndex, endIndex);
        
        if (paginatedData.length === 0) {
            container.innerHTML = '<div class="no-data">Không tìm thấy giao dịch nào</div>';
            return;
        }
        
        // Hiển thị kết quả
        paginatedData.forEach(transaction => {
            const transactionEl = document.createElement('div');
            transactionEl.className = 'transaction-item';
            transactionEl.innerHTML = `
                <div class="transaction-content">
                    <div class="transaction-title">${transaction.content}</div>
                    <div class="transaction-meta">
                        ${transaction.date} | ${transaction.category} ${transaction.note ? '| ' + transaction.note : ''}
                    </div>
                </div>
                <div class="transaction-amount ${transaction.type === 'Thu nhập' ? 'income-amount' : 'expense-amount'}">
                    ${transaction.type === 'Thu nhập' ? '+' : '-'}${formatCurrency(transaction.amount)}
                </div>
            `;
            container.appendChild(transactionEl);
        });
        
        // Cập nhật phân trang
        updatePagination(searchResults.length, 'pageInfoSearch', 'prevPageSearch', 'nextPageSearch');
    }

    // ==========================================================================
    // 12. Tab 7: Quản lý từ khóa
    // ==========================================================================
    function fetchCategories() {
        try {
            // Sử dụng dữ liệu nội tuyến
            const categories = [...categoriesData.income_categories, ...categoriesData.expense_categories];
            
            // Điền danh mục vào dropdown
            populateCategoryDropdowns(categories);
            
            // Tải từ khóa
            fetchKeywords();
            
        } catch (error) {
            console.error('Lỗi khi tải danh mục:', error);
            showError('tab7', 'Không thể tải danh mục. Vui lòng thử lại sau.');
        }
    }

    function fetchKeywords() {
        showLoading('tab7');
        hideMessages('tab7');

        try {
            // Sử dụng dữ liệu nội tuyến
            keywordsData = sampleKeywords;
            
            // Hiển thị từ khóa
            displayKeywords();
            
            showSuccess('tab7', `Đã tải ${keywordsData.length} từ khóa`);
        } catch (error) {
            console.error('Lỗi khi tải từ khóa:', error);
            showError('tab7', 'Không thể tải từ khóa. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab7');
        }
    }

    function displayKeywords() {
        const container = document.getElementById('keywordsContainer');
        container.innerHTML = '';
        
        if (keywordsData.length === 0) {
            container.innerHTML = '<div class="no-data">Không có từ khóa nào</div>';
            return;
        }
        
        // Hiển thị từ khóa theo danh mục
        const categoriesMap = {};
        
        keywordsData.forEach(keyword => {
            if (!categoriesMap[keyword.category]) {
                categoriesMap[keyword.category] = [];
            }
            categoriesMap[keyword.category].push(keyword.keyword);
        });
        
        Object.keys(categoriesMap).forEach(category => {
            const categorySection = document.createElement('div');
            categorySection.className = 'category-section';
            categorySection.innerHTML = `<h3>${category}</h3>`;
            
            const keywordsList = document.createElement('div');
            keywordsList.className = 'keywords-list';
            
            categoriesMap[category].forEach(keyword => {
                const keywordItem = document.createElement('div');
                keywordItem.className = 'keyword-item';
                keywordItem.textContent = keyword;
                keywordsList.appendChild(keywordItem);
            });
            
            categorySection.appendChild(keywordsList);
            container.appendChild(categorySection);
        });
    }

    function addKeyword() {
        const category = document.getElementById('keywordCategory').value;
        const keyword = document.getElementById('keywordInput').value.trim();
        
        if (!category || !keyword) {
            showError('tab7', 'Vui lòng chọn danh mục và nhập từ khóa');
            return;
        }
        
        showLoading('tab7');
        
        try {
            // Thêm từ khóa vào dữ liệu
            keywordsData.push({ category, keyword });
            
            // Hiển thị lại danh sách
            displayKeywords();
            
            // Reset form
            document.getElementById('keywordInput').value = '';
            
            showSuccess('tab7', `Đã thêm từ khóa "${keyword}" vào danh mục "${category}"`);
        } catch (error) {
            console.error('Lỗi khi thêm từ khóa:', error);
            showError('tab7', 'Không thể thêm từ khóa. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab7');
        }
    }

    function deleteKeyword() {
        const category = document.getElementById('keywordCategory').value;
        const keyword = document.getElementById('keywordInput').value.trim();
        
        if (!category || !keyword) {
            showError('tab7', 'Vui lòng chọn danh mục và nhập từ khóa');
            return;
        }
        
        showLoading('tab7');
        
        try {
            // Xóa từ khóa
            const index = keywordsData.findIndex(k => 
                k.category === category && k.keyword === keyword
            );
            
            if (index === -1) {
                showError('tab7', 'Không tìm thấy từ khóa này trong danh mục');
                return;
            }
            
            keywordsData.splice(index, 1);
            
            // Hiển thị lại danh sách
            displayKeywords();
            
            // Reset form
            document.getElementById('keywordInput').value = '';
            
            showSuccess('tab7', `Đã xóa từ khóa "${keyword}" khỏi danh mục "${category}"`);
        } catch (error) {
            console.error('Lỗi khi xóa từ khóa:', error);
            showError('tab7', 'Không thể xóa từ khóa. Vui lòng thử lại sau.');
        } finally {
            hideLoading('tab7');
        }
    }

    // ==========================================================================
    // 13. Modal quản lý giao dịch
    // ==========================================================================
    function openEditForm(transactionId) {
        // Tìm giao dịch
        const transaction = [...transactionsData, ...searchResults].find(t => t.id === transactionId);
        
        if (!transaction) return;
        
        // Điền dữ liệu vào form
        document.getElementById('editTransactionId').value = transaction.id;
        document.getElementById('editDate').value = transaction.date;
        document.getElementById('editContent').value = transaction.content;
        document.getElementById('editAmount').value = formatCurrencyInput(transaction.amount);
        document.getElementById('editType').value = transaction.type;
        document.getElementById('editCategory').value = transaction.category;
        document.getElementById('editNote').value = transaction.note || '';
        
        // Hiển thị modal
        document.getElementById('editModal').style.display = 'flex';
    }

    function closeEditForm() {
        document.getElementById('editModal').style.display = 'none';
    }

    function openAddForm() {
        // Reset form
        document.getElementById('addDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('addContent').value = '';
        document.getElementById('addAmount').value = '';
        document.getElementById('addType').value = 'Chi tiêu';
        document.getElementById('addCategory').value = '';
        document.getElementById('addNote').value = '';
        
        // Hiển thị modal
        document.getElementById('addModal').style.display = 'flex';
    }

    function closeAddForm() {
        document.getElementById('addModal').style.display = 'none';
    }

    function openConfirmDelete(transactionId) {
        // Lưu ID giao dịch cần xóa
        document.getElementById('confirmDeleteBtn').dataset.id = transactionId;
        
        // Hiển thị modal
        document.getElementById('confirmDeleteModal').style.display = 'flex';
    }

    function closeConfirmDeleteModal() {
        document.getElementById('confirmDeleteModal').style.display = 'none';
    }

    function saveEditedTransaction(e) {
        e.preventDefault();
        
        const id = document.getElementById('editTransactionId').value;
        const date = document.getElementById('editDate').value;
        const content = document.getElementById('editContent').value.trim();
        const amount = parseInt(document.getElementById('editAmount').value.replace(/\./g, ''));
        const type = document.getElementById('editType').value;
        const category = document.getElementById('editCategory').value;
        const note = document.getElementById('editNote').value.trim();
        
        if (!date || !content || !amount || !category) {
            document.getElementById('editError').textContent = 'Vui lòng điền đầy đủ thông tin';
            return;
        }
        
        try {
            // Cập nhật giao dịch trong dữ liệu
            const transactionIndex = sampleTransactions.findIndex(t => t.id === id);
            if (transactionIndex !== -1) {
                sampleTransactions[transactionIndex] = {
                    ...sampleTransactions[transactionIndex],
                    date,
                    content,
                    amount,
                    type,
                    category,
                    note
                };
            }
            
            // Đóng modal và làm mới dữ liệu
            closeEditForm();
            
            // Làm mới tab hiện tại
            if (currentTab === 'tab1') {
                fetchDailyTransactions();
            } else if (currentTab === 'tab5') {
                fetchMonthlyExpenses();
            }
            
            showSuccess(currentTab, 'Đã cập nhật giao dịch thành công');
        } catch (error) {
            console.error('Lỗi khi cập nhật giao dịch:', error);
            showError(currentTab, 'Không thể cập nhật giao dịch. Vui lòng thử lại sau.');
        }
    }

    function saveNewTransaction(e) {
        e.preventDefault();
        
        const date = document.getElementById('addDate').value;
        const content = document.getElementById('addContent').value.trim();
        const amount = parseInt(document.getElementById('addAmount').value.replace(/\./g, ''));
        const type = document.getElementById('addType').value;
        const category = document.getElementById('addCategory').value;
        const note = document.getElementById('addNote').value.trim();
        
        if (!date || !content || !amount || !category) {
            document.getElementById('addError').textContent = 'Vui lòng điền đầy đủ thông tin';
            return;
        }
        
        try {
            // Thêm giao dịch mới
            const newTransaction = {
                id: 'GD' + Math.floor(Math.random() * 10000),
                date,
                content,
                amount,
                type,
                category,
                note
            };
            
            sampleTransactions.push(newTransaction);
            
            // Đóng modal và làm mới dữ liệu
            closeAddForm();
            
            // Làm mới tab hiện tại
            if (currentTab === 'tab1') {
                fetchDailyTransactions();
            } else if (currentTab === 'tab5') {
                fetchMonthlyExpenses();
            }
            
            showSuccess(currentTab, 'Đã thêm giao dịch mới thành công');
        } catch (error) {
            console.error('Lỗi khi thêm giao dịch:', error);
            showError(currentTab, 'Không thể thêm giao dịch. Vui lòng thử lại sau.');
        }
    }

    function confirmDelete() {
        const transactionId = document.getElementById('confirmDeleteBtn').dataset.id;
        
        try {
            // Xóa giao dịch
            const transactionIndex = sampleTransactions.findIndex(t => t.id === transactionId);
            if (transactionIndex !== -1) {
                sampleTransactions.splice(transactionIndex, 1);
            }
            
            // Đóng modal và làm mới dữ liệu
            closeConfirmDeleteModal();
            
            // Làm mới tab hiện tại
            if (currentTab === 'tab1') {
                fetchDailyTransactions();
            } else if (currentTab === 'tab5') {
                fetchMonthlyExpenses();
            }
            
            showSuccess(currentTab, 'Đã xóa giao dịch thành công');
        } catch (error) {
            console.error('Lỗi khi xóa giao dịch:', error);
            showError(currentTab, 'Không thể xóa giao dịch. Vui lòng thử lại sau.');
        }
    }

    // ==========================================================================
    // 14. Hàm tiện ích
    // ==========================================================================
    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(amount);
    }

    function formatCurrencyInput(amount) {
        return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    function updatePagination(totalItems, pageInfoId, prevBtnId, nextBtnId) {
        const totalPages = Math.ceil(totalItems / transactionsPerPage);
        document.getElementById(pageInfoId).textContent = `Trang ${currentPage}/${totalPages}`;
        
        document.getElementById(prevBtnId).disabled = currentPage === 1;
        document.getElementById(nextBtnId).disabled = currentPage === totalPages || totalPages === 0;
    }

    function changePage(direction) {
        const totalPages = Math.ceil(transactionsData.length / transactionsPerPage);
        currentPage += direction;
        
        if (currentPage < 1) currentPage = 1;
        if (currentPage > totalPages) currentPage = totalPages;
        
        displayDailyTransactions();
    }

    function changeMonthlyPage(direction) {
        const totalPages = Math.ceil(transactionsData.length / transactionsPerPage);
        currentPage += direction;
        
        if (currentPage < 1) currentPage = 1;
        if (currentPage > totalPages) currentPage = totalPages;
        
        displayMonthlyExpenses();
    }

    function changeSearchPage(direction) {
        const totalPages = Math.ceil(searchResults.length / transactionsPerPage);
        currentPage += direction;
        
        if (currentPage < 1) currentPage = 1;
        if (currentPage > totalPages) currentPage = totalPages;
        
        displaySearchResults();
    }

    function showLoading(tabId) {
        document.getElementById(`loading${tabId.charAt(3).toUpperCase() + tabId.slice(4)}`).style.display = 'block';
    }

    function hideLoading(tabId) {
        document.getElementById(`loading${tabId.charAt(3).toUpperCase() + tabId.slice(4)}`).style.display = 'none';
    }

    function showError(tabId, message) {
        const errorElement = document.getElementById(`errorMessage${tabId.charAt(3).toUpperCase() + tabId.slice(4)}`);
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }

    function showSuccess(tabId, message) {
        const successElement = document.getElementById(`successMessage${tabId.charAt(3).toUpperCase() + tabId.slice(4)}`);
        successElement.textContent = message;
        successElement.style.display = 'block';
    }

    function hideMessages(tabId) {
        const tabNum = tabId.charAt(3).toUpperCase() + tabId.slice(4);
        document.getElementById(`errorMessageTab${tabNum}`).style.display = 'none';
        document.getElementById(`successMessageTab${tabNum}`).style.display = 'none';
    }
  </script>
</body>
</html>
